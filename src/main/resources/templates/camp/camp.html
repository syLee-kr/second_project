<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>캠핑장 목록</title>
  <link rel="stylesheet" type="text/css" href="/css/camp/camp.css">
  <link rel="stylesheet" th:href="@{/css/footer.css}">
  <script>
    function openModal() {
      document.getElementById('recommendModal').classList.add('open');
    }
    function closeModal() {
      document.getElementById('recommendModal').classList.remove('open');
    }
  </script>
</head>
<body>
<h1>캠핑장 검색</h1>

<!-- (1) 검색 폼 -->
<form th:action="@{/camp}" method="get">
  <select name="searchType">
    <option value="address" th:selected="${param.searchType == 'address'}">주소</option>
    <option value="themeEnvironment" th:selected="${param.searchType == 'themeEnvironment'}">테마환경</option>
    <option value="glamping" th:selected="${param.searchType == 'glamping'}">주요시설 글램핑</option>
    <!-- etc... 필요한 필드 추가 -->
  </select>
  <input type="text" name="searchKeyword" th:value="${param.searchKeyword}" />
  <button type="submit">검색</button>
</form>

<hr/>

<!-- (2) 관리자 전용: 추천 키워드 등록 -->
<div th:if="${session.role == 'ADMIN'}">
  <h3>추천 키워드 등록</h3>
  <form th:action="@{/camp/addKeyword}" method="post">
    <label>컬럼명:</label>
    <select name="columnName">
      <option value="address">주소</option>
      <option value="themeEnvironment">테마환경</option>
      <option value="glamping">주요시설 글램핑</option>
      <option value="carCamping">주요시설 자동차야영장</option>
      <!-- etc... -->
    </select>
    <label>키워드:</label>
    <input type="text" name="keyword" placeholder="ex) 낚시" />
    <label>라벨(#포함 권장):</label>
    <input type="text" name="label" placeholder="#낚시" />
    <button type="submit">추가</button>
  </form>
</div>

<!-- (3) 추천 키워드 목록 (모든 사용자) -->
<div th:if="${recommendedKeywords != null and recommendedKeywords.size() > 0}">
  <h3>추천 키워드</h3>
  <ul>
    <li th:each="rk : ${recommendedKeywords}">
      <!-- 예: #낚시 -->
      <a th:text="${rk.label}"
         th:href="@{/camp(searchType=${rk.columnName}, searchKeyword=${rk.keyword})}">#낚시</a>

      <!-- 관리자만 삭제 버튼 노출 -->
      <form th:if="${session.role == 'ADMIN'}" th:action="@{/camp/removeKeyword}" method="post" style="display:inline;">
        <input type="hidden" name="id" th:value="${rk.id}" />
        <button type="submit">삭제</button>
      </form>
    </li>
  </ul>
</div>

<hr/>

<!-- (4) 검색 결과 -->
<div>
  <h2>검색 결과</h2>
  <p>총 개수: <span th:text="${totalCount}">0</span></p>

  <div th:if="${totalCount == 0}">
    <p>검색 결과가 없습니다.</p>
  </div>

  <div th:if="${totalCount > 0}">
    <table border="1">
      <tr>
        <th>야영장명</th>
        <th>주소</th>
        <th>테마환경</th>
        <th>글램핑(개수)</th>
      </tr>
      <tr th:each="camp : ${camps}">
        <td th:text="${camp.name}">CampName</td>
        <td th:text="${camp.address}">Address</td>
        <td th:text="${camp.themeEnvironment}">Theme</td>
        <td th:text="${camp.glamping}">GlampingCount</td>
      </tr>
    </table>

    <!-- 블록 페이징 -->
    <div>
      <span th:if="${startPage > 1}">
        <a th:href="@{/camp(page=${startPage - 1},
                            searchType=${param.searchType},
                            searchKeyword=${param.searchKeyword})}">&laquo;이전</a>
      </span>

      <span th:each="p : ${#numbers.sequence(startPage, endPage)}">
        <a th:if="${p != currentPage}"
           th:href="@{/camp(page=${p},
                           searchType=${param.searchType},
                           searchKeyword=${param.searchKeyword})}"
           th:text="${p}"></a>
        <span th:if="${p == currentPage}" th:text="${p}">1</span>
        <span> </span>
      </span>

      <span th:if="${endPage < totalPages}">
        <a th:href="@{/camp(page=${endPage + 1},
                            searchType=${param.searchType},
                            searchKeyword=${param.searchKeyword})}">다음&raquo;</a>
      </span>
    </div>
  </div>
</div>

<hr/>

<!-- (5) 평점 10개 미만 -->
<div th:if="${randomCamps != null}">
  <h2>아직 10개 미만의 평점을 등록하셨네요!</h2>
  <p>아래 버튼을 눌러 <strong>10개 랜덤 캠핑장</strong>에 대해 1등(10점) ~ 10등(1점) 순위를 매겨주세요.</p>
  <button type="button" onclick="openModal()">추천 점수 등록하기</button>
</div>
<div th:if="${randomCamps == null}">
  <p>로그인이 필요하거나 이미 평점을 10개 이상 등록하셨습니다.</p>
</div>

<!-- (6) 파이썬 추천 호출 버튼(예시) -->
<form th:action="@{/camp/recommend}" method="post">
  <button type="submit">내 맞춤추천 받기 (Python 서버)</button>
</form>

<!-- (7) 모달창 -->
<div id="recommendModal" class="modal-overlay" th:if="${randomCamps != null}">
  <div class="modal-content">
    <span class="close-button" onclick="closeModal()">&times;</span>
    <h2>10개 캠핑장 순위 입력</h2>
    <p>1등=10점, 2등=9점, ... 10등=1점</p>
    <form th:action="@{/camp/recommend}" method="post">
      <table border="1">
        <tr>
          <th>야영장명</th>
          <th>주소</th>
          <th>순위</th>
        </tr>
        <tr th:each="camp : ${randomCamps}">
          <td th:text="${camp.name}">CampName</td>
          <td th:text="${camp.address}">Address</td>
          <td>
            <input type="hidden" name="campId" th:value="${camp.id}" />
            <select name="rank">
              <option th:each="r : ${#numbers.sequence(1,10)}"
                      th:value="${r}"
                      th:text="${r}"></option>
            </select>
          </td>
        </tr>
      </table>
      <button type="submit">순위 제출</button>
    </form>
  </div>
</div>

<div th:replace="~{footer :: footer}"></div>
</body>
</html>
